---
title: "Puerto Rico Stream Analysis"
author: "Jaslyn Miura"
format: html
warning: false
editor_options: 
  chunk_output_type: console
---

# Jaslyn Miura

# jaslyntmiura\@ucsb.edu

```{r}
#| echo: false
# load in libraries ------------------------------------------------------------
library(tidyverse)
library(here)
library(lubridate)
library(janitor)
library(patchwork)
```

## Background

Within this analysis we examine Puerto Rico's stream nutrient concentrations before and after a disturbance. Background information and data was obtained from the following sources:

Schaefer DouglasA, McDowell WH, Scatena FN, Asbury CE. Effects of hurricane disturbance on stream water concentrations and fluxes in eight tropical forest watersheds of the Luquillo Experimental Forest, Puerto Rico. *Journal of Tropical Ecology*. 2000;16(2):189-207. doi:10.1017/S0266467400001358

McDowell, W. and International Institute of Tropical Forestry(IITF), USDA Forest Service.. 2024. Chemistry of stream water from the Luquillo Mountains ver 4923064. Environmental Data Initiative. https://doi.org/10.6073/pasta/f31349bebdc304f758718f4798d25458 (Accessed 2025-08-29).

## Data

For this analysis, we focused on four sites Puente Roto Mameyes (MPR), Quebrada one-Bisley (Q1), Quebrada two-Bisley (Q2), and Quebrada three-Bisley (Q3) within a ten year time period, 1988 -1998. We analyzed the concentration levels of potassium, nitrate nitrogen, magnesium, calcium, and ammonium nitrate.

```{r}
# using source to call in our cleaned data and functions that were created in a separate R script
stream_data <- readRDS(here("outputs", "stream_data.rds"))
head(stream_data)

```

## Methods

To smooth out the data and identify trends in the data, a nine week moving average for each nutrient concentration was calculated between 1989-1999.

## Results


```{r}

stream_moving_avg <- readRDS(here("outputs", "stream_moving_avg.rds"))
head(stream_moving_avg, n = 10)

```

After determining the moving average, plots for each nutrient was created. Hurricane Hugo was also defined as the disturbance in this analysis as 1989-09-20 (a midpoint date of the event).

Creating each nutrient concentration graph.

```{r}

# defining the date of Hurricane Hugo, so it can be highlighted on our graph
hugo <- as.Date("1989-09-20")

# calling in the individual nutrient subset data sets to plot individual nutrients first
potassium_moving_avg <- readRDS(here("outputs", "potassium_moving_avg.rds"))
nitrate_moving_avg <- readRDS(here("outputs", "nitrate_moving_avg.rds"))
magnesium_moving_avg <- readRDS(here("outputs", "magnesium_moving_avg.rds"))
calcium_moving_avg <- readRDS(here("outputs", "potassium_moving_avg.rds"))
amm_nitrate_moving_avg <- readRDS(here("outputs", "amm_nitrate_moving_avg.rds"))

# plotting potassium concentrations
potassium_plot <- ggplot(data = potassium_moving_avg,
                         aes(x = sample_date, y = moving_avg, linetype = sample_id)) +
  geom_line() +
  geom_vline(xintercept = hugo, color = "dodgerblue", linewidth = 0.8) +
  theme_minimal() + 
  labs(title = "Stream Concentrations Before and After Hurricane Hugo",
       x = NULL,
       y = "K mg l^-1") + 
  theme(legend.title = element_blank()) +
  theme(legend.position = "top" ) +
  theme(plot.title.position = "plot")

# plotting nitrate concentrations
nitrate_plot <- ggplot(data = nitrate_moving_avg,
       aes(x = sample_date, y = moving_avg, linetype = sample_id)) +
  geom_line() +
  geom_vline(xintercept = hugo, color = "dodgerblue") +
  theme_minimal() + 
  labs(x = NULL,
       y = "NO3-N mg l^-1") +
  theme(legend.position = "none")

# plotting magnesium concentrations
magnesium_plot <- ggplot(data = magnesium_moving_avg,
       aes(x = sample_date, y = moving_avg, linetype = sample_id)) +
  geom_line() +
  geom_vline(xintercept = hugo, color = "dodgerblue") +
  theme_minimal() +
  labs(x = NULL,
       y = "Mg l^-1") + 
  theme(legend.position = "none")

# plotting calcium concentrations
calcium_plot <- ggplot(data = calcium_moving_avg,
       aes(x = sample_date, y = moving_avg, linetype = sample_id)) +
  geom_line() + 
  geom_vline(xintercept = hugo, color = "dodgerblue") +
  theme_minimal() +
  labs(x = NULL,
       y = "Ca l^-1") + 
  theme(legend.position = "none")

# plotting ammonium nitrate concentrations
amm_nitrate_plot <- ggplot(data = amm_nitrate_moving_avg,
       aes(x = sample_date, y = moving_avg, linetype = sample_id)) +
  geom_line() + 
  geom_vline(xintercept = hugo, color = "dodgerblue") +
  theme_minimal() +
  labs(x = "Years",
       y = "NH4-N mg l^-1")  +
  theme(legend.position = "none")

```

Combining individual concentration graphs to compare concentration levels.

```{r}

# using patchwork to combine all our nutrient graphs into one final figure
figure_3 <- (potassium_plot / nitrate_plot / magnesium_plot / calcium_plot / amm_nitrate_plot) + 
  plot_layout(axes = "collect")

figure_3

```

```{r}
#| echo: false

# saving our final figure into our figs folder
ggsave(here("figs", "figure_3.png"), height = 8, width = 6)

```

After the occurrence of a disturbance in Puerto Rico, such as Hurricane Hugo, there appears to be an increase in fluctuations of nutrient concentrations for about two years.
